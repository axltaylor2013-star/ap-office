-- BankUI.client.lua
-- Full bank interface with deposit/withdraw

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui", 5)
local Remotes = ReplicatedStorage:WaitForChild("Remotes", 5)

-- Wait for bank remotes (created by BankManager)
local bankOpenRemote
local bankActionRemote
local bankUpdateRemote

task.spawn(function()
	bankOpenRemote = Remotes:WaitForChild("BankOpen", 15)
	bankActionRemote = Remotes:WaitForChild("BankAction", 15)
	bankUpdateRemote = Remotes:WaitForChild("BankUpdate", 15)
	if bankOpenRemote and bankActionRemote and bankUpdateRemote then
		print("[BankUI] Bank remotes connected")
	else
		warn("[BankUI] Some bank remotes not found!")
	end
end)

-- === COLORS ===
local COLORS = {
	bg = Color3.fromRGB(15, 15, 25),
	panel = Color3.fromRGB(25, 25, 40),
	item = Color3.fromRGB(35, 35, 55),
	itemHover = Color3.fromRGB(50, 50, 75),
	gold = Color3.fromRGB(255, 215, 0),
	white = Color3.fromRGB(220, 220, 220),
	green = Color3.fromRGB(80, 200, 80),
	red = Color3.fromRGB(200, 80, 80),
	blue = Color3.fromRGB(80, 130, 220),
	dimText = Color3.fromRGB(140, 140, 160),
}

-- === MAIN SCREEN GUI ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BankUI"
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 10
screenGui.Parent = playerGui

-- === BANK WINDOW (hidden by default) ===
local bankFrame = Instance.new("Frame")
bankFrame.Name = "BankWindow"
bankFrame.Size = UDim2.new(0, 700, 0, 500)
bankFrame.Position = UDim2.new(0.5, -350, 0.5, -250)
bankFrame.BackgroundColor3 = COLORS.bg
bankFrame.BackgroundTransparency = 0.05
bankFrame.BorderSizePixel = 0
bankFrame.Visible = false
bankFrame.Parent = screenGui

local bankCorner = Instance.new("UICorner")
bankCorner.CornerRadius = UDim.new(0, 12)
bankCorner.Parent = bankFrame

-- Gold border effect
local bankStroke = Instance.new("UIStroke")
bankStroke.Color = COLORS.gold
bankStroke.Thickness = 2
bankStroke.Transparency = 0.3
bankStroke.Parent = bankFrame

-- === TITLE BAR ===
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 45)
titleBar.BackgroundColor3 = COLORS.panel
titleBar.BorderSizePixel = 0
titleBar.Parent = bankFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleBar

-- Fix bottom corners of title bar
local titleFix = Instance.new("Frame")
titleFix.Size = UDim2.new(1, 0, 0, 12)
titleFix.Position = UDim2.new(0, 0, 1, -12)
titleFix.BackgroundColor3 = COLORS.panel
titleFix.BorderSizePixel = 0
titleFix.Parent = titleBar

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -50, 1, 0)
titleLabel.Position = UDim2.new(0, 15, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "ðŸ¦ BANK OF WILDERNESS"
titleLabel.TextColor3 = COLORS.gold
titleLabel.TextScaled = true
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

-- Close button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 35, 0, 35)
closeBtn.Position = UDim2.new(1, -40, 0, 5)
closeBtn.BackgroundColor3 = COLORS.red
closeBtn.Text = "âœ•"
closeBtn.TextColor3 = COLORS.white
closeBtn.TextScaled = true
closeBtn.Font = Enum.Font.GothamBold
closeBtn.BorderSizePixel = 0
closeBtn.Parent = titleBar

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(0, 6)
closeBtnCorner.Parent = closeBtn

closeBtn.MouseButton1Click:Connect(function()
	bankFrame.Visible = false
end)

-- === STATUS BAR ===
local statusBar = Instance.new("TextLabel")
statusBar.Size = UDim2.new(1, -20, 0, 25)
statusBar.Position = UDim2.new(0, 10, 0, 48)
statusBar.BackgroundTransparency = 1
statusBar.Text = ""
statusBar.TextColor3 = COLORS.dimText
statusBar.TextScaled = true
statusBar.Font = Enum.Font.Gotham
statusBar.TextXAlignment = Enum.TextXAlignment.Left
statusBar.Parent = bankFrame

-- === TWO COLUMNS: BANK (left) + INVENTORY (right) ===

-- BANK PANEL (left)
local bankPanel = Instance.new("Frame")
bankPanel.Name = "BankPanel"
bankPanel.Size = UDim2.new(0.5, -15, 1, -120)
bankPanel.Position = UDim2.new(0, 10, 0, 78)
bankPanel.BackgroundColor3 = COLORS.panel
bankPanel.BackgroundTransparency = 0.3
bankPanel.BorderSizePixel = 0
bankPanel.Parent = bankFrame

local bankPanelCorner = Instance.new("UICorner")
bankPanelCorner.CornerRadius = UDim.new(0, 8)
bankPanelCorner.Parent = bankPanel

local bankTitle = Instance.new("TextLabel")
bankTitle.Size = UDim2.new(1, 0, 0, 30)
bankTitle.BackgroundTransparency = 1
bankTitle.Text = "ðŸ¦ BANK (0/100)"
bankTitle.TextColor3 = COLORS.gold
bankTitle.TextScaled = true
bankTitle.Font = Enum.Font.GothamBold
bankTitle.Parent = bankPanel

local bankScroll = Instance.new("ScrollingFrame")
bankScroll.Size = UDim2.new(1, -10, 1, -35)
bankScroll.Position = UDim2.new(0, 5, 0, 32)
bankScroll.BackgroundTransparency = 1
bankScroll.ScrollBarThickness = 4
bankScroll.ScrollBarImageColor3 = COLORS.gold
bankScroll.Parent = bankPanel

local bankLayout = Instance.new("UIListLayout")
bankLayout.Padding = UDim.new(0, 3)
bankLayout.Parent = bankScroll

-- INVENTORY PANEL (right)
local invPanel = Instance.new("Frame")
invPanel.Name = "InvPanel"
invPanel.Size = UDim2.new(0.5, -15, 1, -120)
invPanel.Position = UDim2.new(0.5, 5, 0, 78)
invPanel.BackgroundColor3 = COLORS.panel
invPanel.BackgroundTransparency = 0.3
invPanel.BorderSizePixel = 0
invPanel.Parent = bankFrame

local invPanelCorner = Instance.new("UICorner")
invPanelCorner.CornerRadius = UDim.new(0, 8)
invPanelCorner.Parent = invPanel

local invTitle = Instance.new("TextLabel")
invTitle.Size = UDim2.new(1, 0, 0, 30)
invTitle.BackgroundTransparency = 1
invTitle.Text = "ðŸŽ’ INVENTORY (0/28)"
invTitle.TextColor3 = COLORS.gold
invTitle.TextScaled = true
invTitle.Font = Enum.Font.GothamBold
invTitle.Parent = invPanel

local invScroll = Instance.new("ScrollingFrame")
invScroll.Size = UDim2.new(1, -10, 1, -35)
invScroll.Position = UDim2.new(0, 5, 0, 32)
invScroll.BackgroundTransparency = 1
invScroll.ScrollBarThickness = 4
invScroll.ScrollBarImageColor3 = COLORS.gold
invScroll.Parent = invPanel

local invLayout = Instance.new("UIListLayout")
invLayout.Padding = UDim.new(0, 3)
invLayout.Parent = invScroll

-- === BOTTOM BUTTONS ===
local buttonBar = Instance.new("Frame")
buttonBar.Size = UDim2.new(1, -20, 0, 40)
buttonBar.Position = UDim2.new(0, 10, 1, -48)
buttonBar.BackgroundTransparency = 1
buttonBar.Parent = bankFrame

local buttonLayout = Instance.new("UIListLayout")
buttonLayout.FillDirection = Enum.FillDirection.Horizontal
buttonLayout.Padding = UDim.new(0, 10)
buttonLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
buttonLayout.Parent = buttonBar

local function createButton(text, color, parent)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 180, 0, 36)
	btn.BackgroundColor3 = color
	btn.Text = text
	btn.TextColor3 = COLORS.white
	btn.TextScaled = true
	btn.Font = Enum.Font.GothamBold
	btn.BorderSizePixel = 0
	btn.Parent = parent

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 8)
	corner.Parent = btn

	-- Hover effect
	btn.MouseEnter:Connect(function()
		TweenService:Create(btn, TweenInfo.new(0.15), {
			BackgroundColor3 = Color3.new(
				math.min(color.R * 1.2, 1),
				math.min(color.G * 1.2, 1),
				math.min(color.B * 1.2, 1)
			)
		}):Play()
	end)
	btn.MouseLeave:Connect(function()
		TweenService:Create(btn, TweenInfo.new(0.15), { BackgroundColor3 = color }):Play()
	end)

	return btn
end

local depositAllBtn = createButton("ðŸ“¥ Deposit All", COLORS.green, buttonBar)
local closeBottomBtn = createButton("âœ• Close Bank", COLORS.red, buttonBar)

closeBottomBtn.MouseButton1Click:Connect(function()
	bankFrame.Visible = false
end)

-- === ITEM ROW CREATION ===
local function createItemRow(itemName, quantity, parent, actionType)
	local row = Instance.new("TextButton")
	row.Size = UDim2.new(1, -5, 0, 32)
	row.BackgroundColor3 = COLORS.item
	row.BorderSizePixel = 0
	row.Text = ""
	row.AutoButtonColor = false
	row.Parent = parent

	local rowCorner = Instance.new("UICorner")
	rowCorner.CornerRadius = UDim.new(0, 6)
	rowCorner.Parent = row

	-- Item name
	local nameLabel = Instance.new("TextLabel")
	nameLabel.Size = UDim2.new(0.6, 0, 1, 0)
	nameLabel.Position = UDim2.new(0, 10, 0, 0)
	nameLabel.BackgroundTransparency = 1
	nameLabel.Text = itemName
	nameLabel.TextColor3 = COLORS.white
	nameLabel.TextScaled = true
	nameLabel.Font = Enum.Font.Gotham
	nameLabel.TextXAlignment = Enum.TextXAlignment.Left
	nameLabel.Parent = row

	-- Quantity
	local qtyLabel = Instance.new("TextLabel")
	qtyLabel.Size = UDim2.new(0, 40, 1, 0)
	qtyLabel.Position = UDim2.new(0.6, 5, 0, 0)
	qtyLabel.BackgroundTransparency = 1
	qtyLabel.Text = "x" .. quantity
	qtyLabel.TextColor3 = COLORS.dimText
	qtyLabel.TextScaled = true
	qtyLabel.Font = Enum.Font.Gotham
	qtyLabel.Parent = row

	-- Action button
	local actionBtn = Instance.new("TextButton")
	actionBtn.Size = UDim2.new(0, 70, 0, 24)
	actionBtn.Position = UDim2.new(1, -78, 0.5, -12)
	actionBtn.BorderSizePixel = 0
	actionBtn.TextScaled = true
	actionBtn.Font = Enum.Font.GothamBold
	actionBtn.Parent = row

	local actionCorner = Instance.new("UICorner")
	actionCorner.CornerRadius = UDim.new(0, 4)
	actionCorner.Parent = actionBtn

	if actionType == "withdraw" then
		actionBtn.Text = "ðŸ“¤ Take"
		actionBtn.BackgroundColor3 = COLORS.blue
		actionBtn.TextColor3 = COLORS.white
		actionBtn.MouseButton1Click:Connect(function()
			if bankActionRemote then
				bankActionRemote:FireServer("withdraw", itemName, 1)
			end
		end)
	else
		actionBtn.Text = "ðŸ“¥ Store"
		actionBtn.BackgroundColor3 = COLORS.green
		actionBtn.TextColor3 = COLORS.white
		actionBtn.MouseButton1Click:Connect(function()
			if bankActionRemote then
				bankActionRemote:FireServer("deposit", itemName, 1)
			end
		end)
	end

	-- Hover effects
	row.MouseEnter:Connect(function()
		TweenService:Create(row, TweenInfo.new(0.1), { BackgroundColor3 = COLORS.itemHover }):Play()
	end)
	row.MouseLeave:Connect(function()
		TweenService:Create(row, TweenInfo.new(0.1), { BackgroundColor3 = COLORS.item }):Play()
	end)

	return row
end

-- === UPDATE DISPLAY ===
local function updateBankDisplay(bankData, invData)
	-- Clear existing rows
	for _, child in ipairs(bankScroll:GetChildren()) do
		if child:IsA("TextButton") then child:Destroy() end
	end
	for _, child in ipairs(invScroll:GetChildren()) do
		if child:IsA("TextButton") then child:Destroy() end
	end

	-- Update bank items
	bankTitle.Text = "ðŸ¦ BANK (" .. #bankData .. "/100)"
	for _, slot in ipairs(bankData) do
		createItemRow(slot.name, slot.quantity, bankScroll, "withdraw")
	end
	bankScroll.CanvasSize = UDim2.new(0, 0, 0, #bankData * 35)

	-- Update inventory items
	invTitle.Text = "ðŸŽ’ INVENTORY (" .. #invData .. "/28)"
	for _, slot in ipairs(invData) do
		createItemRow(slot.name, slot.quantity, invScroll, "deposit")
	end
	invScroll.CanvasSize = UDim2.new(0, 0, 0, #invData * 35)

	-- Empty state messages
	if #bankData == 0 then
		local emptyLabel = Instance.new("TextLabel")
		emptyLabel.Size = UDim2.new(1, 0, 0, 50)
		emptyLabel.BackgroundTransparency = 1
		emptyLabel.Text = "Bank is empty\nDeposit items to keep them safe!"
		emptyLabel.TextColor3 = COLORS.dimText
		emptyLabel.TextScaled = true
		emptyLabel.Font = Enum.Font.Gotham
		emptyLabel.Parent = bankScroll
	end

	if #invData == 0 then
		local emptyLabel = Instance.new("TextLabel")
		emptyLabel.Size = UDim2.new(1, 0, 0, 50)
		emptyLabel.BackgroundTransparency = 1
		emptyLabel.Text = "Inventory is empty\nGather resources first!"
		emptyLabel.TextColor3 = COLORS.dimText
		emptyLabel.TextScaled = true
		emptyLabel.Font = Enum.Font.Gotham
		emptyLabel.Parent = invScroll
	end
end

-- === SHOW STATUS MESSAGE ===
local function showStatus(text, color)
	statusBar.Text = text
	statusBar.TextColor3 = color or COLORS.dimText
	task.delay(3, function()
		if statusBar.Text == text then
			statusBar.Text = ""
		end
	end)
end

-- === CONNECT REMOTES ===
task.spawn(function()
	-- Wait for remotes to be available
	task.wait(2)

	if bankOpenRemote then
		bankOpenRemote.OnClientEvent:Connect(function(bankData, invData)
			updateBankDisplay(bankData, invData)
			bankFrame.Visible = true
			showStatus("Welcome to the Bank of Wilderness!", COLORS.gold)
		end)
	end

	if bankUpdateRemote then
		bankUpdateRemote.OnClientEvent:Connect(function(bankData, invData, success, action)
			updateBankDisplay(bankData, invData)
			if success then
				if action == "deposit" then
					showStatus("âœ… Item deposited successfully!", COLORS.green)
				elseif action == "withdraw" then
					showStatus("âœ… Item withdrawn successfully!", COLORS.green)
				elseif action == "deposit_all" then
					showStatus("âœ… All items deposited!", COLORS.green)
				end
			else
				if action == "deposit" or action == "deposit_all" then
					showStatus("âŒ Bank is full or item not found!", COLORS.red)
				elseif action == "withdraw" then
					showStatus("âŒ Inventory full or item not found!", COLORS.red)
				end
			end
		end)
	end
end)

-- Deposit All button
depositAllBtn.MouseButton1Click:Connect(function()
	if bankActionRemote then
		bankActionRemote:FireServer("deposit_all", "all", 1)
	end
end)

-- Close bank when player moves too far
task.spawn(function()
	while true do
		task.wait(1)
		if bankFrame.Visible then
			local character = player.Character
			if character then
				local root = character:FindFirstChild("HumanoidRootPart")
				if root then
					local bankNPC = game.Workspace:FindFirstChild("SafeZone")
					if bankNPC then
						local npc = bankNPC:FindFirstChild("BankNPC")
						if npc then
							local npcRoot = npc:FindFirstChild("HumanoidRootPart")
							if npcRoot then
								local dist = (root.Position - npcRoot.Position).Magnitude
								if dist > 15 then
									bankFrame.Visible = false
									showStatus("You walked too far from the bank.", COLORS.red)
								end
							end
						end
					end
				end
			end
		end
	end
end)

print("[BankUI] Bank interface loaded!")
