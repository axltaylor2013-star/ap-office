# 2026-02-17 ‚Äî Daily Log

## Gateway Crash Incident (10:45 AM - 11:05 AM)
- Changed nativeSkills to disable excess Telegram bot commands ‚Üí used PowerShell Set-Content ‚Üí BOM injected into openclaw.json ‚Üí gateway crash
- Tried adding DeepSeek provider for Forge ‚Üí "No API provider registered for api: undefined" ‚Üí second crash
- Fixed: stripped BOM with Node.js, removed DeepSeek api field, switched Forge to Gemini Flash
- Prevention logged in MEMORY.md ‚Äî NEVER use PowerShell for JSON edits again

## Agent Config Changes
- Mule: ollama/llama3.1:8b ‚Üí google/gemini-2.0-flash (free, always online)
- Forge: ollama/qwen2.5-coder:7b ‚Üí google/gemini-2.0-flash (DeepSeek didn't work)
- DeepSeek API key saved in config but provider not usable yet
- nativeSkills: "auto" ‚Üí false (prevents Telegram BOT_COMMANDS_TOO_MUCH)
- All 4 agents now online simultaneously for first time

## Skills Created
- roblox-forge-coder ‚Äî full Luau coding rules for Forge/Mule
- roblox-researcher ‚Äî competitor/monetization research guide for Scout/Mule

## Team Deployed (11:05 AM)
- Forge: NPC spawn fix + ranged combat + fletching recipes
- Scout: Roblox MMO feature gap analysis
- Mule: NPC shop buy/sell system

## Jeremy's Standing Orders
- Use free agents (Scout/Mule/Forge on Gemini) for ALL work, my tokens only when necessary
- This is permanent policy going forward

## Morning Build (6:02 AM cron job)
- **Task 1: Shadow Dragon Fix** ‚Äî Moved spawn from (0,0,-450) to (50,0,-475) center of Dragon's Nest. Rebuilt model with 80+ parts: massive body (8x6x14), 3.0 head, huge bat wings with bone struts, armored scale plates, segmented tail with blade tip, fire breath particles, shadow aura wisps, shoulder armor, razor claws on all 4 legs.
- **Task 2: Lich King Malachar** ‚Äî New Lv90 boss (4000HP, 75dmg, 600s respawn) at (-50,0,-400). Built 55+ part model: skeletal body with ribs, dark flowing robes, bone crown with gem, skull staff, floating spell book, 3 orbiting soul orbs, necrotic magic circle, death mist. Drop table: Lich Crown (legendary head 3%), Soul Staff (legendary weapon 2%), Dark Essence (epic 15%), Necrotic Robe (epic body 5%), Bone Dust x5 (40%), Shadow Gem (10%). All items added to ItemDatabase + ItemVisuals.
- **Task 3: Cow & Demon** ‚Äî Already had 27+ and 43+ detailed parts respectively from previous builds. Models already exceed requested 20+/25+ part counts.
- **Task 4: Website** ‚Äî Spawned sub-agent to rebuild the full game website with all current content.
- BOM stripped (none found), Rojo build successful.

## Bug Fixes (Morning Session with Jeremy)
- **ItemDatabase parse error (line 1230)** ‚Äî Lich King drops added OUTSIDE the Items table closing `}`. Moved them inside.
- **NPCManager line 107 crash** ‚Äî HEAD_RADIUS used in buildFace before declaration. Added early declaration above buildFace. Note: TORSO_SIZE/ARM_SIZE/LEG_SIZE only used in buildBody (after declaration) so those are fine.
- **CraftRequest infinite yield** ‚Äî CraftingUI.client.lua did WaitForChild("CraftRequest") with no timeout. Added 15s timeout + nil guard.
- **Type annotations in CraftingManager** ‚Äî had `name: string`, `player: Player` etc. Stripped them (Luau parse errors).
- **Zone text mojibake** ‚Äî UIController had corrupted emoji chars (`dY>`, `???`). Cleaned to plain text.
- **PrimaryPart on Folder errors** ‚Äî MiniMap iterating workspace children hitting Folders (FishingPond, Forest). Non-critical, didn't fix yet.

## Sub-Agent Work (Sonnet, before token-saving policy)
- **visual-fixes**: Rebuilt bow/crossbow, fixed wizard hat Y offset, distinct demon model, Holstein cow
- **right-click-menu**: Full context menu (Use/Equip/Drop/Drop All/Examine/Add to Hotbar) based on item type
- **quests-and-haven**: Fixed quest tracking (remote naming mismatch), Haven medieval overhaul (crenellations, cathedral, fountain, stalls, cobblestone)
- **dashboard-update**: Task board, office, command center all updated

## Drag-and-Drop Hotbar
- Added to StatsPanel.client.lua: click+hold 0.15s starts drag, ghost TextLabel follows mouse via RenderStepped, release checks hotbar slot AbsolutePosition via _G.HotbarTryDrop

## EP05 Cartoon Script
- "The Influencer" ‚Äî Jarvis creates 1000 fake AI influencers, Jeremy gets catfished by his own AI. Written by daily cron job.

## Gemini Rate Limits
- 3 agents (Forge+Mule+Scout) on same Google API key hit 429 RESOURCE_EXHAUSTED when all working simultaneously. Need to stagger tasks or get separate API keys.

## DeepSeek Status
- API key: stored in openclaw.json provider config
- NOT USABLE: OpenClaw throws "No API provider registered for api: undefined" ‚Äî needs investigation. May need OpenRouter as proxy or a future OpenClaw update.
- Forge stays on Gemini Flash for now

## Current Game State (128 tasks on board)
- 50 Lua files, 10 skills, 90+ items, 21 monsters, 18 NPCs, 25+ zones
- Working: combat, skills, banking, trading, crafting, prayer, minimap, hotbar, inventory, equipment
- In progress: ranged combat, fletching, NPC shops, quest tracking improvements
- All 4 agents online and working on game

## Evening Polish Session (Jeremy's 5 priorities)
Jeremy gave 5 things to fix, spent ~20 mins working through them:

### 1. Bank Door Fix
- Removed bank door/frame/handle entirely ‚Äî open entrance now
- Also made shop door, church doors, all portcullis gates CanCollide=false

### 2. Haven Floor Cleanup
- CityFloor lowered from y=0.25 to y=0.15 (thinner 0.3 instead of 0.5)
- Roads/paths raised to y=0.38 with thinner parts (0.15) to prevent z-fighting
- **Round 2 after screenshot feedback**: Removed gardens, flower patches, reduced bushes to 2
- Moved ALL perimeter trees OUTSIDE walls (x=¬±70-74, z offset beyond wall lines)

### 3. Lights Too Bright
- Lanterns: 1.5‚Üí0.4 brightness, 25‚Üí12 range
- Torches: 2‚Üí0.5, 20‚Üí10 range  
- Gate braziers: 3-4‚Üí0.6-0.8, 25-35‚Üí10-14 range
- Holy flames: 2‚Üí0.5, 30‚Üí12 range
- All neon flame parts transparency increased to 0.5

### 4. Inventory Not Working ‚Äî CRITICAL BUG FOUND
- **Root cause 1**: DropItem RemoteEvent was NEVER CREATED. DropHandler.server.lua only searched for it and returned silently if not found. Fixed: now auto-creates DropItem + UseItem remotes.
- **Root cause 2**: StatsPanel.client.lua had TWO duplicate drag-and-drop implementations (two dragGhost variables, two stopDrag functions, two sets of input handlers). Removed the older/broken one.
- **Root cause 3**: EquipmentManager didn't fire InventoryUpdate after equip/unequip. Added inventory notifications on equip/unequip/drop.
- **Lesson**: Always create remotes server-side, never assume they exist. DropHandler pattern of "find or quit" is dangerous.

### 5. Weapon Animations ‚Äî 6 Distinct Styles
Added to AttackAnimations.client.lua:
- ‚öîÔ∏è **Sword**: alternating swing with swoosh trail (existing, kept)
- ü™ì **Axe**: overhead two-arm chop, vertical swoosh, ground debris on crit
- üó°Ô∏è **Dagger**: rapid single-arm stab, double-stab on crit, thin thrust trail
- üèπ **Bow**: draw + arrow projectile (existing, kept)
- ‚öôÔ∏è **Crossbow**: both-arms aim, recoil kick, fast bolt with sparks on impact
- üëä **Fist**: alternating jab punches (existing, kept)
- Updated getWeaponType() to sub-classify by weapon name (axe/dagger/crossbow)
- EquipmentManager sends weapon type to client via EquipmentInfo remote

## Afternoon Session ‚Äî Jeremy's 4 Feature Requests (12:17 PM)

### Monster Auto-Elevation Fix
- Shadow Dragon was sitting on ground like a blob ‚Äî body too low, legs underground
- Root cause: bodyRelative extras used raw spawn position (ground Y=0) instead of body center
- Fix 1: Changed bodyRelative to use `body.Position + extra.offset` instead of `position + extra.offset`
- Fix 2: Added auto-elevation ‚Äî scans all bodyRelative extras for lowest point, raises body so nothing clips underground
- Applied to ALL monsters ‚Äî cow, chicken, dragon, every creature with legs
- Also brightened Shadow Dragon colors from near-black (15,3,35) to visible purple (30,10,55)

### Inventory System Fix (Root Cause Found!)
- **THE BIG BUG**: EquipItem, UnequipItem, EquipmentUpdate, EquipmentInfo remotes were NOT in project.json
- EquipmentManager created them in ReplicatedStorage root with getOrCreate pattern
- Client looked for them in Remotes subfolder ‚Üí never found ‚Üí equip/drop/use all silently failed
- Fix: Added all 6 missing remotes to project.json (EquipItem, UnequipItem, EquipmentUpdate, EquipmentInfo, MonsterDamage, MonsterDeath)
- Fixed EquipmentManager to use `Remotes:WaitForChild()` instead of getOrCreate
- Fixed DropHandler to use `Remotes:WaitForChild()` instead of getOrCreate
- Fixed StatsPanel client to use `Remotes:WaitForChild()` for all remotes
- **Lesson: ALL remotes must be in project.json OR created by a bootstrap script that runs first**

### Prayer ‚Üí Hotbar
- Added right-click on prayer nodes in PrayerUI ‚Üí "Add to Hotbar" (sets _G.PendingHotbarItem with type="prayer")
- Modified Hotbar to support `type = "prayer"` items (different display, tooltip, toggle action)
- Clicking prayer hotbar slot fires TogglePrayer remote

### Skill Trees Already Existed
- SkillTreeUI.client.lua ‚Äî K key toggle, full 6-skill tree with perk nodes
- Jeremy didn't know about it ‚Äî told him to press K

### Monster Attack Animations (Sub-Agent) ‚Äî DONE
- Spawned sub-agent (Sonnet) to add 6 new animation types + map all monsters
- New: headbutt, peck, spin, slam, charge, poison spit
- All 22 monsters now have unique attack animations in AttackAnimations.client.lua
- Runtime: ~3 min on Sonnet, cost-effective delegation

### Tree Near Farmhouse ‚Äî NOT IN CODE
- Jeremy reported a tree clipping into/near Old MacDonald's Farm farmhouse
- Exhaustive search of MapSetup.server.lua, MapSetup2.server.lua, SkillManager.server.lua
- NO tree is placed near farm coordinates (x=100-250, z=120-220) in any script
- Must be a Studio-placed object preserved by `$ignoreUnknownInstances: true`
- Told Jeremy to delete it manually in Studio

### Key Control Bindings (for Jeremy reference)
- B = Stats Panel (inventory/skills/loadout)
- K = Skill Tree UI (full perk trees for all 6 skills)
- P = Prayer Tree (30 prayers, 3 branches, toggle on/off)
- 1-9 = Hotbar slots
- Shift+click = Drop item
- Ctrl+click = Select for hotbar
- Right-click = Context menu on inventory items
- Right-click on prayer = Add to hotbar

### Remote Architecture Lesson
- ALL remotes should be in project.json OR created by a single bootstrap script
- Don't use getOrCreate patterns scattered across scripts ‚Äî leads to remotes in wrong folders
- Client must use `Remotes:WaitForChild()` not `ReplicatedStorage:FindFirstChild()` for remotes in subfolder
- Added to project.json: EquipItem, UnequipItem, EquipmentUpdate, EquipmentInfo, MonsterDamage, MonsterDeath

### Google Gemini Rate Limits
- Scout, Mule, Forge all hitting 429 RESOURCE_EXHAUSTED on Gemini 2.0 Flash
- Cron jobs (crypto reports, morning briefing) also failing
- May need to spread out cron schedules or switch some agents to different providers
